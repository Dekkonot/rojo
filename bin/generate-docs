#!/bin/sh

# Kludged documentation generator to support multiple versions.

set -e

REMOTE=$(git remote get-url origin)
CHECKOUT="$(mktemp -d)"
OUTPUT="$(pwd)/site/docs"

if [ -d site ]
then
	cd site
	git pull
else
	git clone https://github.com/rojo-rbx/rojo-rbx.github.io site
	cd site
fi

rm -rf docs
mkdir docs
cp ../bin/docs-index.html docs/index.html

git clone "$REMOTE" "$CHECKOUT"
cd "$CHECKOUT"

echo "Building master"
git checkout master
mkdocs build --site-dir "$OUTPUT/latest"

echo "Building 0.5.x"
mkdocs build --site-dir "$OUTPUT/0.5.x"

echo "Building 0.4.x"
git checkout v0.4.x
mkdocs build --site-dir "$OUTPUT/0.4.x"